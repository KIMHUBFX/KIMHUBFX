<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Analysis Tool • KIMHUBFX</title>
<link rel="stylesheet" href="style.css">
<style>
/* ---- PAGE STYLING ---- */
.analysis-card {
  background: #ffffff;
  padding: 15px;
  margin: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.digit-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 10px;
  padding: 10px 0;
}

.digit-box {
  background: #f3f3f3;
  border-radius: 8px;
  padding: 12px;
  text-align: center;
  font-weight: bold;
  color: #ff444f;
  font-size: 18px;
}

.tick-list {
  max-height: 230px;
  overflow-y: auto;
  background: #fafafa;
  padding: 10px;
  border-radius: 8px;
  font-family: monospace;
  font-size: 14px;
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div id="sidebar" class="sidebar">
  <div class="side-inner">
    <h2>KIMHUBFX</h2>

    <div class="section-title">Account</div>
    <a href="#">Account Settings</a>
    <a href="#">Cashier</a>
    <a href="#">Dark Theme</a>

    <div class="section-title">Channels</div>
    <a href="https://wa.me/254724753475" target="_blank">WhatsApp</a>
    <a href="https://whatsapp.com/channel/0029Vb77BD8B4hdNphlldH3g" target="_blank">WhatsApp Channel</a>
    <a href="https://www.youtube.com/@kimhtai" target="_blank">YouTube</a>
    <a href="https://www.tiktok.com/@kimh.tai" target="_blank">TikTok</a>
    <a href="https://t.me/kimhubfx" target="_blank">Telegram</a>
    <a href="https://www.instagram.com/kimh.tai" target="_blank">Instagram</a>
    <a href="https://www.facebook.com/profile.php?id=61582999149557" target="_blank">Facebook</a>
  </div>
</div>

<!-- TOP BAR -->
<header class="topbar">
  <div class="left">
    <button class="icon-btn" onclick="appUI.openMenu()">☰</button>
    <span class="logo">KIMHUBFX</span>
  </div>
  <div id="authContainer" class="auth-buttons"></div>
</header>

<!-- MENU BAR -->
<nav class="horizontal-menu">
  <div onclick="location.href='dashboard.html'">Dashboard</div>
  <div onclick="location.href='bot-builder.html'">Bot Builder</div>
  <div onclick="location.href='freebots.html'">FreeBots</div>
  <div class="active">Analysis Tool</div>
  <div onclick="location.href='analysis.html'">Analysis</div>
  <div onclick="location.href='dp-tool.html'">DP Tool</div>
  <div onclick="location.href='dtrader.html'">DTrader</div>
  <div onclick="location.href='wallet.html'">Wallet</div>
</nav>

<!-- PAGE CONTENT -->
<main class="container">

  <h2>Analysis Tool</h2>

  <!-- MARKET SELECTOR -->
  <div class="analysis-card">
    <h3>Select Market</h3>
    <select id="marketSelect" style="padding:10px; width:100%; border-radius:8px;">

      <!-- NORMAL VOLATILITY -->
      <option value="R_10">Volatility 10</option>
      <option value="R_25">Volatility 25</option>
      <option value="R_50">Volatility 50</option>
      <option value="R_75">Volatility 75</option>
      <option value="R_100" selected>Volatility 100</option>

      <!-- 1s VOLATILITY -->
      <option value="1HZ10V">Volatility 10 (1s)</option>
      <option value="1HZ25V">Volatility 25 (1s)</option>
      <option value="1HZ50V">Volatility 50 (1s)</option>
      <option value="1HZ75V">Volatility 75 (1s)</option>
      <option value="1HZ100V">Volatility 100 (1s)</option>

      <!-- HF VOLATILITY -->
      <option value="R_10_HF">Volatility 10 HF</option>
      <option value="R_25_HF">Volatility 25 HF</option>
      <option value="R_50_HF">Volatility 50 HF</option>
      <option value="R_75_HF">Volatility 75 HF</option>
      <option value="R_100_HF">Volatility 100 HF</option>
    </select>
  </div>

  <!-- DIGIT STATS -->
  <div class="analysis-card">
    <h3>Digit Frequency (0–9)</h3>

    <div class="digit-grid" id="digitGrid"></div>
  </div>

  <!-- TICK STREAM -->
  <div class="analysis-card">
    <h3>Live Tick Stream</h3>
    <div id="tickStream" class="tick-list"></div>
  </div>

</main>

<script src="menu.js"></script>

<script>
/* =====================
     DIGIT ENGINE
======================*/
let digitCount = Array(10).fill(0);
let tickHistory = [];
let ws;

/* Draw digit grid */
function buildDigitGrid(){
  const box = document.getElementById("digitGrid");
  box.innerHTML = "";
  for(let i=0;i<10;i++){
    const div = document.createElement("div");
    div.className = "digit-box";
    div.id = "digit"+i;
    div.innerText = i + ": 0%";
    box.appendChild(div);
  }
}

/* Update frequency boxes */
function updateDigitBoxes(){
  let total = digitCount.reduce((a,b)=>a+b,0);
  for(let d=0; d<10; d++){
    let pct = total === 0 ? 0 : ((digitCount[d]/total)*100).toFixed(1);
    document.getElementById("digit"+d).innerText = `${d}: ${pct}%`;
  }
}

/* Update tick stream */
function pushTick(price, digit){
  tickHistory.unshift(`Tick: ${price} → digit: ${digit}`);
  if(tickHistory.length > 50) tickHistory.pop();
  document.getElementById("tickStream").innerHTML = tickHistory.join("<br>");
}

/* Process tick */
function handleTick(t){
  let price = t.quote;
  let digit = Number(String(price).slice(-1));

  digitCount[digit]++;
  updateDigitBoxes();
  pushTick(price, digit);
}

/* Connect to Deriv */
function connectWS(symbol){
  if(ws) ws.close();

  ws = new WebSocket("wss://ws.binaryws.com/websockets/v3?app_id=1089");

  ws.onopen = () => {
    ws.send(JSON.stringify({
      ticks: symbol,
      subscribe: 1
    }));
  };

  ws.onmessage = msg => {
    let data = JSON.parse(msg.data);
    if(data.tick) handleTick(data.tick);
  };
}

/* Change market */
document.getElementById("marketSelect").addEventListener("change", ()=>{
  digitCount = Array(10).fill(0);
  tickHistory = [];
  updateDigitBoxes();
  document.getElementById("tickStream").innerHTML = "";
  connectWS(document.getElementById("marketSelect").value);
});

/* Initialize */
document.addEventListener("DOMContentLoaded", ()=>{
  appUI.renderAuthButtons('authContainer');
  buildDigitGrid();
  connectWS("R_100");
});
</script>

</body>
</html>