<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Redirecting...</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
</head>
<body>
  <p>Completing login…</p>
<script>
  // Deriv may return token in fragment (#token=...) or query (?token=...)
  (function() {
    function getFromHash() {
      const h = window.location.hash || '';
      if (!h) return null;
      const frag = h.startsWith('#') ? h.slice(1) : h;
      const parts = frag.split('&');
      for (const p of parts) {
        const [k,v] = p.split('=');
        if (!k || !v) continue;
        if (k === 'token' || k === 'access_token') return decodeURIComponent(v);
      }
      return null;
    }
    function getFromQuery() {
      const q = new URLSearchParams(window.location.search);
      return q.get('token') || q.get('access_token') || null;
    }

    const token = getFromHash() || getFromQuery();
    if (token) {
      localStorage.setItem('auth_token', token);
      // remove fragment/query from URL
      window.history.replaceState({}, document.title, '/KIMHUBFX/dashboard.html');
      // redirect to dashboard
      window.location.href = 'dashboard.html';
    } else {
      document.body.innerHTML = '<h2>No token received — please login again</h2><p><a href="login.html">Back to Login</a></p>';
    }
  })();
</script>
</body>
</html>